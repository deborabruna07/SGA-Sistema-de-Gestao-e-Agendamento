<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Agendamento - Sal√£o</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
</head>
<body>

<div class="container">

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
    {% for categoria, mensagem in messages %}
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                var texto = "{{ mensagem }}";
                var categoria = "{{ categoria }}";

                // Atualiza o texto do pop-up
                document.getElementById("popup-msg").innerText = texto;

                // Configura√ß√£o para CANCELAMENTO
                if (categoria === 'cancelado') {
                    document.getElementById("popup-titulo").innerText = "Cancelamento Confirmado";
                    document.getElementById("popup-icon").innerText = "üóëÔ∏è";
                    document.getElementById("popup-btn").style.background = "#e53935"; // Vermelho
                } 
                // Configura√ß√£o para SUCESSO (Agendamento)
                else if (categoria === 'sucesso') {
                    document.getElementById("popup-titulo").innerText = "Agendamento Confirmado!";
                    document.getElementById("popup-icon").innerText = "‚úÖ";
                    document.getElementById("popup-btn").style.background = "#4CAF50"; // Verde
                }

                // Abre o popup
                abrirPopup();
            });
        </script>
    {% endfor %}
{% endif %}
{% endwith %}

<h1>Sistema de Agendamento</h1>
<h2>Agendar Servi√ßo</h2>

<form method="post" action="/agendar" class="form-agendamento">

    <input type="hidden" name="data" id="dataSelecionada">
    <input type="hidden" name="hora" id="horaSelecionada">

    <div class="linha">
        <input type="text" name="cliente" placeholder="Nome do cliente" required>

        <select name="servico" id="servico" required>
            <option value="">Selecione o servi√ßo</option>
            {% for s in servicos %}
                <option value="{{ s[0] }}">{{ s[1] }}</option>
            {% endfor %}
        </select>
    </div>

    <div id="calendario-container">
        <h3 class="escolha-data">Escolha a data</h3>
        <div id="calendar"></div>
    </div>

    <div class="legenda-calendario">
        <span class="legenda fechado"></span>
    </div>

    <div id="horarios-container" style="display:none">
        <h3>Hor√°rios dispon√≠veis</h3>
        <div id="horarios"></div>
    </div>

    <div id="dados-cliente" style="display:none;" class="dados-cliente">
        <h3>Dados para contato</h3>

        <input type="text" id="nomeCliente" name="cliente" placeholder="Seu nome">
        <input type="tel" id="telefoneCliente" name="telefoneCliente" placeholder="WhatsApp (ex: 55 83 9 9999-9999)">
        <input type="email" id="emailCliente" name="emailCliente" placeholder="E-mail">

        <p class="privacidade">
            Seus dados s√£o usados apenas para contato sobre este agendamento.
        </p>
    </div>

    <button type="submit" class="btn-principal">Confirmar</button>
</form>

<div class="meus-agendamentos-container">
    <h2>Meus Agendamentos</h2>

    <div class="tabela-wrapper">
        <table class="tabela-cliente">
            <thead>
                <tr>
                    <th>Cliente</th>
                    <th>Servi√ßo</th>
                    <th>Data</th>
                    <th>In√≠cio</th>
                    <th>Fim</th>
                    <th>Status</th>
                    <th>A√ß√£o</th>
                </tr>
            </thead>
            <tbody>
                {% for a in agendamentos %}
                <tr>
                    <td>{{ a[1] }}</td> <td>{{ a[2] }}</td> <td>{{ a[3] }}</td> <td>{{ a[4] }}</td> <td>{{ a[5] }}</td> <td>{{ a[6] }}</td> <td>
                        {% if a[6] == 'Confirmado' %}
                            <a href="/cancelar/{{ a[0] }}" class="btn-cancelar-link" onclick="return confirm('Tem certeza que deseja cancelar este agendamento?')">Cancelar</a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
                
                {% if not agendamentos %}
                <tr>
                    <td colspan="7">Nenhum agendamento encontrado.</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

</div> <script src="{{ url_for('static', filename='calendar.js') }}"></script>

<div id="popup-sucesso" class="popup">
    <div class="popup-box">
        <div id="popup-icon" class="popup-icon">‚úÖ</div>
        <h3 id="popup-titulo">Agendamento confirmado!</h3>
        <p id="popup-msg">Seu hor√°rio foi agendado com sucesso.</p>
        <button id="popup-btn" onclick="fecharPopup()">OK</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/interaction.global.min.js"></script>

</body>
</html>